var Agentation=(()=>{var f={logo:`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <circle cx="12" cy="12" r="10"/>
    <path d="M12 16v-4"/>
    <path d="M12 8h.01"/>
  </svg>`,pause:`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <rect x="6" y="4" width="4" height="16"/>
    <rect x="14" y="4" width="4" height="16"/>
  </svg>`,play:`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <polygon points="5 3 19 12 5 21 5 3"/>
  </svg>`,eye:`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/>
    <circle cx="12" cy="12" r="3"/>
  </svg>`,eyeOff:`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19m-6.72-1.07a3 3 0 1 1-4.24-4.24"/>
    <line x1="1" y1="1" x2="23" y2="23"/>
  </svg>`,copy:`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <rect x="9" y="9" width="13" height="13" rx="2" ry="2"/>
    <path d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1"/>
  </svg>`,check:`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <polyline points="20 6 9 17 4 12"/>
  </svg>`,trash:`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <polyline points="3 6 5 6 21 6"/>
    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/>
  </svg>`,settings:`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <circle cx="12" cy="12" r="3"/>
    <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
  </svg>`,close:`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <line x1="18" y1="6" x2="6" y2="18"/>
    <line x1="6" y1="6" x2="18" y2="18"/>
  </svg>`,chevronDown:`<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
    <polyline points="6 9 12 15 18 9"/>
  </svg>`};var ct=`
/* Agentation Toolbar */
.agentation-toolbar {
  position: fixed;
  z-index: 2147483647;
  font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
  font-size: 14px;
  line-height: 1.4;
  box-sizing: border-box;
}

.agentation-toolbar *,
.agentation-toolbar *::before,
.agentation-toolbar *::after {
  box-sizing: border-box;
}

/* Toolbar inner container */
.agentation-toolbar-inner {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 8px 12px;
  background: var(--agentation-bg, #1f2937);
  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.25);
  transition: all 0.2s ease;
}

/* Collapsed state */
.agentation-toolbar.collapsed .agentation-toolbar-inner {
  padding: 0;
  width: 44px;
  height: 44px;
  border-radius: 50%;
  justify-content: center;
  cursor: pointer;
}

.agentation-toolbar.collapsed .agentation-controls {
  display: none;
}

/* Buttons */
.agentation-btn {
  display: flex;
  align-items: center;
  justify-content: center;
  width: 32px;
  height: 32px;
  padding: 0;
  border: none;
  border-radius: 8px;
  background: transparent;
  color: var(--agentation-text, #f3f4f6);
  cursor: pointer;
  transition: all 0.15s ease;
}

.agentation-btn:hover {
  background: var(--agentation-hover, #374151);
}

.agentation-btn.active {
  background: var(--agentation-accent, #3b82f6);
}

.agentation-btn svg {
  width: 18px;
  height: 18px;
}

/* Badge (collapsed state) */
.agentation-badge {
  position: relative;
  display: flex;
  align-items: center;
  justify-content: center;
  width: 100%;
  height: 100%;
}

.agentation-badge-count {
  position: absolute;
  top: -4px;
  right: -4px;
  min-width: 18px;
  height: 18px;
  padding: 0 5px;
  background: var(--agentation-accent, #3b82f6);
  border-radius: 9px;
  font-size: 11px;
  font-weight: 600;
  color: white;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* Controls section */
.agentation-controls {
  display: flex;
  align-items: center;
  gap: 4px;
}

/* Annotation count */
.agentation-count {
  min-width: 28px;
  padding: 4px 8px;
  background: var(--agentation-accent, #3b82f6);
  border-radius: 14px;
  font-size: 12px;
  font-weight: 600;
  color: white;
  text-align: center;
}

/* Divider */
.agentation-divider {
  width: 1px;
  height: 20px;
  background: var(--agentation-border, #4b5563);
  margin: 0 4px;
}

/* Markers */
.agentation-marker {
  position: absolute;
  width: 24px;
  height: 24px;
  margin-left: -12px;
  margin-top: -12px;
  border-radius: 50%;
  background: var(--agentation-accent, #3b82f6);
  color: white;
  font-size: 12px;
  font-weight: 600;
  font-family: system-ui, -apple-system, sans-serif;
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  z-index: 2147483646;
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
  transition: transform 0.15s ease;
  pointer-events: auto;
}

.agentation-marker:hover {
  transform: scale(1.15);
}

.agentation-marker.multi-select {
  background: #10b981;
}

/* Fixed markers container */
.agentation-markers-fixed {
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 2147483645;
}

/* Scrolling markers container */
.agentation-markers-scroll {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  pointer-events: none;
  z-index: 2147483644;
}

/* Hover highlight */
[data-agentation-highlight] {
  outline: 2px solid var(--agentation-accent, #3b82f6) !important;
  outline-offset: 2px !important;
}

/* Popup */
.agentation-popup {
  position: fixed;
  z-index: 2147483647;
  padding: 12px;
  background: var(--agentation-bg, #1f2937);
  border-radius: 12px;
  box-shadow: 0 4px 20px rgba(0, 0, 0, 0.3);
  font-family: system-ui, -apple-system, sans-serif;
}

.agentation-popup-header {
  display: flex;
  align-items: center;
  gap: 8px;
  margin-bottom: 8px;
  color: var(--agentation-text, #f3f4f6);
  font-size: 12px;
  opacity: 0.8;
}

.agentation-popup-input {
  width: 300px;
  min-height: 60px;
  padding: 10px;
  border: 1px solid var(--agentation-border, #4b5563);
  border-radius: 8px;
  background: transparent;
  color: var(--agentation-text, #f3f4f6);
  font-size: 14px;
  font-family: inherit;
  resize: vertical;
}

.agentation-popup-input:focus {
  outline: none;
  border-color: var(--agentation-accent, #3b82f6);
}

.agentation-popup-hint {
  margin-top: 8px;
  font-size: 11px;
  color: var(--agentation-text, #f3f4f6);
  opacity: 0.6;
}

/* Drag selection box */
.agentation-drag-box {
  position: fixed;
  border: 2px dashed var(--agentation-accent, #3b82f6);
  background: rgba(59, 130, 246, 0.1);
  pointer-events: none;
  z-index: 2147483646;
}

/* Drag highlight */
.agentation-drag-highlight {
  position: absolute;
  background: rgba(59, 130, 246, 0.2);
  border: 2px solid var(--agentation-accent, #3b82f6);
  pointer-events: none;
  z-index: 2147483645;
}

/* Theme: Light mode */
.agentation-toolbar.light {
  --agentation-bg: #ffffff;
  --agentation-text: #1f2937;
  --agentation-hover: #f3f4f6;
  --agentation-border: #d1d5db;
}

.agentation-popup.light {
  --agentation-bg: #ffffff;
  --agentation-text: #1f2937;
  --agentation-border: #d1d5db;
}

/* Auto theme */
@media (prefers-color-scheme: light) {
  .agentation-toolbar.auto,
  .agentation-popup.auto {
    --agentation-bg: #ffffff;
    --agentation-text: #1f2937;
    --agentation-hover: #f3f4f6;
    --agentation-border: #d1d5db;
  }
}

/* Animation: Entrance */
@keyframes agentation-scale-in {
  from {
    transform: scale(0.8);
    opacity: 0;
  }
  to {
    transform: scale(1);
    opacity: 1;
  }
}

.agentation-toolbar {
  animation: agentation-scale-in 0.2s ease-out;
}

.agentation-marker {
  animation: agentation-scale-in 0.15s ease-out;
}

/* Animation: Popup shake */
@keyframes agentation-shake {
  0%, 100% { transform: translateX(0); }
  25% { transform: translateX(-4px); }
  75% { transform: translateX(4px); }
}

.agentation-popup.shake {
  animation: agentation-shake 0.3s ease-in-out;
}

/* Block interactions mode */
body.agentation-blocking * {
  cursor: crosshair !important;
}

body.agentation-blocking .agentation-toolbar,
body.agentation-blocking .agentation-toolbar *,
body.agentation-blocking .agentation-popup,
body.agentation-blocking .agentation-popup *,
body.agentation-blocking .agentation-marker {
  cursor: default !important;
}
`;function B(){if(document.getElementById("agentation-styles"))return;let t=document.createElement("style");t.id="agentation-styles",t.textContent=ct,document.head.appendChild(t)}var A=class{generate(e){let n=e.getAttribute("data-testid")||e.getAttribute("data-element");if(n)return`[data-testid="${n}"]`;if(e.id&&this.isUnique(`#${CSS.escape(e.id)}`))return`#${CSS.escape(e.id)}`;let o=e.getAttribute("aria-label");if(o&&this.isUnique(`[aria-label="${o}"]`))return`[aria-label="${CSS.escape(o)}"]`;let i=this.findUniqueClasses(e);return i||this.buildPath(e)}isUnique(e){try{return document.querySelectorAll(e).length===1}catch{return!1}}findUniqueClasses(e){let n=this.getCleanClasses(e);if(n.length===0)return null;for(let a of n){let r=`.${CSS.escape(a)}`;if(this.isUnique(r))return r}for(let a=2;a<=Math.min(3,n.length);a++){let r=n.slice(0,a).map(l=>`.${CSS.escape(l)}`).join("");if(this.isUnique(r))return r}let o=e.tagName.toLowerCase();for(let a of n.slice(0,2)){let r=`${o}.${CSS.escape(a)}`;if(this.isUnique(r))return r}let i=e.parentElement;if(i){let a=this.getSimpleSelector(i);if(a){let r=n.slice(0,2).map(s=>`.${CSS.escape(s)}`).join(""),l=`${a} > ${o}${r}`;if(this.isUnique(l))return l}}return null}getCleanClasses(e){return Array.from(e.classList).filter(n=>!(n.length<=2||/^_[a-z0-9]+$/i.test(n)||/_[a-f0-9]{5,}$/i.test(n)))}getSimpleSelector(e){if(e.id)return`#${CSS.escape(e.id)}`;let n=this.getCleanClasses(e);return n.length>0?`${e.tagName.toLowerCase()}.${CSS.escape(n[0])}`:null}buildPath(e,n=4){let o=[],i=e,a=0;for(;i&&i!==document.body&&a<n;){let r=i.tagName.toLowerCase(),l=this.getCleanClasses(i);l.length>0&&(r+=`.${CSS.escape(l[0])}`);let s=i.parentElement;if(s){let x=Array.from(s.children).filter(g=>g.tagName===i.tagName);if(x.length>1){let g=x.indexOf(i)+1;r+=`:nth-of-type(${g})`}}o.unshift(r),i=i.parentElement,a++}return o.join(" > ")}getFullPath(e){let n=[],o=e;for(;o&&o!==document.documentElement;){let i=o.tagName.toLowerCase();if(o.id)i+=`#${CSS.escape(o.id)}`;else{let a=this.getCleanClasses(o);a.length>0&&(i+=`.${CSS.escape(a[0])}`)}n.unshift(i),o=o.parentElement}return n.unshift("html"),n.join(" > ")}};var C=new A;function y(t){let e=t.tagName.toLowerCase(),n=t.getAttribute("data-element");if(n)return n;if(t instanceof SVGElement||e==="svg"){let a=t.closest('button, a, [role="button"]');return a?`icon in ${y(a)}`:"graphic"}let o=ut(t);if(e==="button"||t.getAttribute("role")==="button")return o?`button "${p(o,25)}"`:"button";if(e==="a"){if(o)return`link "${p(o,25)}"`;let a=t.getAttribute("href");return a?`link to "${p(a,30)}"`:"link"}if(e==="input"){let a=t.getAttribute("type")||"text",r=t.getAttribute("placeholder"),l=t.getAttribute("name");return`input "${p(r||l||a,20)}"`}if(e==="textarea"){let a=t.getAttribute("placeholder"),r=t.getAttribute("name");return`textarea "${p(a||r||"",20)}"`}if(e==="select"){let a=t.getAttribute("name");return a?`select "${p(a,20)}"`:"select"}if(e==="img"){let a=t.getAttribute("alt");return a?`image "${p(a,25)}"`:"image"}if(/^h[1-6]$/.test(e))return o?`${e} "${p(o,35)}"`:e;if(e==="p")return o?`paragraph: "${p(o,40)}..."`:"paragraph";if(e==="label")return o?`label "${p(o,25)}"`:"label";if(["section","article","nav","header","footer","main","aside"].includes(e)){let a=t.getAttribute("aria-label");return a?`${e} "${p(a,25)}"`:e}if(e==="div"||e==="span"){let a=C.getCleanClasses(t);return a.length>0?`${e}.${a[0]}`:e}let i=C.getCleanClasses(t);return i.length>0?`${e}.${i[0]}`:e}function ut(t){let e="";for(let n of t.childNodes)n.nodeType===Node.TEXT_NODE&&(e+=n.textContent);return e=e.trim(),!e&&t.childElementCount===0&&(e=t.textContent?.trim()||""),e}function p(t,e){return t?(t=t.trim().replace(/\s+/g," "),t.length<=e?t:t.slice(0,e-3)+"..."):""}function D(t){return C.getCleanClasses(t)}function I(t){return C.generate(t)}function _(t){return C.getFullPath(t)}function H(t){let e=[],n=t.textContent?.trim();n&&n.length<100&&e.push(n);let o=t.previousElementSibling;if(o){let a=o.textContent?.trim();a&&a.length<50&&e.unshift(a)}let i=t.nextElementSibling;if(i){let a=i.textContent?.trim();a&&a.length<50&&e.push(a)}return e.join(" | ")}function V(t){let e=t.parentElement;if(!e)return"";let n=Array.from(e.children).filter(o=>o!==t).slice(0,4).map(o=>y(o));return n.length===0?"":n.join(", ")}function q(t){let e=[],n=t.getAttribute("role");n&&e.push(`role="${n}"`);let o=t.getAttribute("aria-label");o&&e.push(`aria-label="${o}"`);let i=t.getAttribute("aria-describedby");i&&e.push(`aria-describedby="${i}"`);let a=t.getAttribute("tabindex");a!==null&&e.push(`tabindex="${a}"`);let r=t.getAttribute("aria-hidden");return r&&e.push(`aria-hidden="${r}"`),t.matches('a[href], button, input, select, textarea, [tabindex]:not([tabindex="-1"])')&&e.push("focusable"),e.join(", ")}function R(t){let e=window.getComputedStyle(t),n={};return n.color=e.color,n.backgroundColor=e.backgroundColor,n.fontSize=e.fontSize,n.fontWeight=e.fontWeight,n.fontFamily=e.fontFamily,n.display=e.display,n.position=e.position,n.padding=e.padding,n.margin=e.margin,n}function U(t){let e=t;for(;e&&e!==document.body;){let n=window.getComputedStyle(e).position;if(n==="fixed"||n==="sticky")return!0;e=e.parentElement}return!1}var dt="agentation-annotations-";function T(){return dt+window.location.pathname}function K(){try{let t=T(),e=localStorage.getItem(t);if(!e)return[];let n=JSON.parse(e),o=Date.now(),i=7*24*60*60*1e3,a=n.filter(r=>r.timestamp&&o-r.timestamp<i);return a.length!==n.length&&L(a),a}catch(t){return console.warn("Agentation: Failed to load annotations",t),[]}}function L(t){try{let e=T();t.length===0?localStorage.removeItem(e):localStorage.setItem(e,JSON.stringify(t))}catch(e){console.warn("Agentation: Failed to save annotations",e)}}function W(){try{let t=T();localStorage.removeItem(t)}catch(t){console.warn("Agentation: Failed to clear annotations",t)}}function J(){try{let t=localStorage.getItem("agentation-settings");return t?JSON.parse(t):{}}catch{return{}}}function X(t){try{localStorage.setItem("agentation-settings",JSON.stringify(t))}catch(e){console.warn("Agentation: Failed to save settings",e)}}var m=[],G=0;function Y(){m=K(),G=m.reduce((t,e)=>{let n=parseInt(e.id.split("-")[1]||"0",10);return Math.max(t,n)},0)+1}function Q(t,e,n="",o=!1){let i=t.getBoundingClientRect(),a=window.scrollY,r=window.scrollX,l=U(t),s={id:`ann-${G++}`,timestamp:Date.now(),x:(i.left+i.width/2)/window.innerWidth*100,y:l?i.top+i.height/2:i.top+i.height/2+a,element:y(t),elementPath:I(t),comment:e,selectedText:n?n.slice(0,500):void 0,boundingBox:{x:Math.round(i.left+r),y:Math.round(i.top+a),width:Math.round(i.width),height:Math.round(i.height)},cssClasses:D(t).join(" ")||void 0,nearbyText:H(t)||void 0,nearbyElements:V(t)||void 0,fullPath:_(t),accessibility:q(t)||void 0,computedStyles:pt(R(t)),isMultiSelect:o||void 0,isFixed:l||void 0};return m.push(s),L(m),s}function pt(t){return Object.entries(t).filter(([,e])=>e&&e!=="none"&&e!=="normal"&&e!=="auto").map(([e,n])=>`${e}: ${n}`).join("; ")}function P(){return[...m]}function M(){m=[],W()}function Z(){return m.length}function tt(t,e={}){let{detail:n="standard",format:o="markdown",route:i=null}=e;return o==="json"?ht(t,n,i):ft(t,n,i)}function ft(t,e,n){if(t.length===0)return`# No annotations

No elements have been annotated.`;if(e==="compact")return gt(t);let o=[];return n?o.push(`## Page Feedback: ${n}`):o.push("## Page Feedback"),o.push(`**Viewport:** ${window.innerWidth}x${window.innerHeight}`),e==="forensic"&&(o.push(`**URL:** ${window.location.href}`),o.push(`**User Agent:** ${navigator.userAgent}`),o.push(`**Device Pixel Ratio:** ${window.devicePixelRatio}`)),o.push(""),t.forEach((i,a)=>{if(o.push(`### ${a+1}. ${i.element}`),o.push(""),e==="forensic"&&i.fullPath?o.push(`**Full DOM Path:** ${i.fullPath}`):o.push(`**Location:** \`${i.elementPath}\``),(e==="detailed"||e==="forensic")&&i.cssClasses&&o.push(`**Classes:** ${i.cssClasses}`),(e==="detailed"||e==="forensic")&&i.boundingBox){let r=i.boundingBox;e==="forensic"?(o.push(`**Position:** x:${r.x}, y:${r.y} (${r.width}\xD7${r.height}px)`),o.push(`**Annotation at:** ${i.x.toFixed(1)}% from left, ${Math.round(i.y)}px from top`)):o.push(`**Position:** ${r.x}px, ${r.y}px (${r.width}\xD7${r.height}px)`)}i.selectedText&&o.push(`**Selected text:** "${i.selectedText}"`),e==="forensic"&&i.computedStyles&&o.push(`**Computed Styles:** ${i.computedStyles}`),e==="forensic"&&i.accessibility&&o.push(`**Accessibility:** ${i.accessibility}`),(e==="detailed"||e==="forensic")&&i.nearbyText&&o.push(`**Context:** "${i.nearbyText}"`),e==="forensic"&&i.nearbyElements&&o.push(`**Nearby Elements:** ${i.nearbyElements}`),o.push(`**Feedback:** ${i.comment||"(no feedback provided)"}`),o.push("")}),o.join(`
`)}function gt(t){return t.map((e,n)=>`${n+1}. ${e.element}: ${e.comment||"(no feedback)"}`).join(`
`)}function ht(t,e,n){let o={route:n||window.location.pathname,viewport:{width:window.innerWidth,height:window.innerHeight},annotations:t.map(i=>mt(i,e))};return e==="forensic"&&(o.url=window.location.href,o.userAgent=navigator.userAgent,o.devicePixelRatio=window.devicePixelRatio,o.timestamp=Date.now()),JSON.stringify(o,null,2)}function mt(t,e){let n={element:t.element,location:t.elementPath,feedback:t.comment||null};return t.selectedText&&(n.selectedText=t.selectedText),(e==="detailed"||e==="forensic")&&(t.cssClasses&&(n.classes=t.cssClasses.split(" ")),t.boundingBox&&(n.position=t.boundingBox),t.nearbyText&&(n.context=t.nearbyText)),e==="forensic"&&(t.fullPath&&(n.fullDOMPath=t.fullPath),t.computedStyles&&(n.computedStyles=t.computedStyles),t.accessibility&&(n.accessibility=t.accessibility),t.nearbyElements&&(n.nearbyElements=t.nearbyElements),n.annotationPosition={xPercent:t.x,yPixels:t.y},n.timestamp=t.timestamp,n.isFixed=t.isFixed||!1,n.isMultiSelect=t.isMultiSelect||!1),n}async function et(t){try{return await navigator.clipboard.writeText(t),!0}catch(e){console.warn("Agentation: Clipboard write failed",e);try{let n=document.createElement("textarea");return n.value=t,n.style.position="fixed",n.style.opacity="0",document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n),!0}catch{return!1}}}function nt(t,e,n,o,i={}){let{theme:a="dark",accentColor:r="#3b82f6"}=i;v();let l=t.getBoundingClientRect(),s=document.createElement("div");s.className=`agentation-popup ${a}`,s.style.setProperty("--agentation-accent",r);let x=l.bottom+8,g=l.left;x+150>window.innerHeight&&(x=l.top-150-8),g+324>window.innerWidth&&(g=window.innerWidth-324-16),g<16&&(g=16),s.style.top=`${x}px`,s.style.left=`${g}px`,s.innerHTML=`
    <div class="agentation-popup-header">
      Annotating: ${bt(e)}
    </div>
    <textarea
      class="agentation-popup-input"
      placeholder="What's the issue with this element?"
      autofocus
    ></textarea>
    <div class="agentation-popup-hint">
      Enter to save \xB7 Shift+Enter for new line \xB7 Escape to cancel
    </div>
  `,document.body.appendChild(s);let w=s.querySelector("textarea");w.focus();let F=h=>{if(h.key==="Enter"&&!h.shiftKey){h.preventDefault();let lt=w.value.trim();v(),n(lt)}else h.key==="Escape"&&(h.preventDefault(),v(),o())};w.addEventListener("keydown",F);let z=h=>{s.contains(h.target)||(w.value.trim()?(s.classList.add("shake"),setTimeout(()=>s.classList.remove("shake"),300)):(v(),o()))};setTimeout(()=>{document.addEventListener("mousedown",z)},100),s._cleanup=()=>{w.removeEventListener("keydown",F),document.removeEventListener("mousedown",z)}}function v(){let t=document.querySelector(".agentation-popup");t&&(t._cleanup&&t._cleanup(),t.remove())}function N(){return!!document.querySelector(".agentation-popup")}function bt(t){let e=document.createElement("div");return e.textContent=t,e.innerHTML}var it=new Map,ot=!1;function xt(t){let e=t.toLowerCase().split("+");return{key:e[e.length-1],ctrl:e.includes("ctrl"),shift:e.includes("shift"),alt:e.includes("alt"),meta:e.includes("meta")||e.includes("cmd")}}function yt(t,e){let n=xt(e),o=t.key.toLowerCase()===n.key,i=t.ctrlKey===n.ctrl,a=t.shiftKey===n.shift,r=t.altKey===n.alt,l=t.metaKey===n.meta;return o&&i&&a&&r&&l}function vt(t){for(let[e,n]of it)if(yt(t,e)){t.preventDefault(),t.stopPropagation(),n();return}}function kt(){ot||(document.addEventListener("keydown",vt,!0),ot=!0)}function at(t,e){kt(),it.set(t.toLowerCase(),e)}var d=null,k=null,S=!1,E=!0,u=null,c={},j={};function O(t={}){j=t,c={detail:t.defaultDetail||"standard",format:t.defaultFormat||"markdown",theme:t.theme||"auto",accentColor:t.accentColor||"#3b82f6",blockInteractions:t.blockInteractions!==!1,autoClearOnCopy:t.autoClearOnCopy||!1,markersVisible:!0,...J()},B(),Y(),wt(),Ct(),$t(),$();let e=t.keyboardShortcut||"ctrl+shift+a";at(e,rt)}function wt(){d=document.createElement("div"),d.className=`agentation-toolbar collapsed ${c.theme}`,d.style.setProperty("--agentation-accent",c.accentColor);let t=j.position||"bottom-right",[e,n]=t.split("-");d.style[e]="16px",d.style[n]="16px",b(),document.body.appendChild(d)}function b(){let t=Z();d.innerHTML=`
    <div class="agentation-toolbar-inner">
      ${E?`
        <div class="agentation-badge">
          ${f.logo}
          ${t>0?`<span class="agentation-badge-count">${t}</span>`:""}
        </div>
      `:`
        <button class="agentation-btn" data-action="toggle" title="Toggle annotation mode">
          ${f.logo}
        </button>
        <div class="agentation-divider"></div>
        <div class="agentation-controls">
          <button class="agentation-btn ${c.markersVisible?"":"active"}" data-action="visibility" title="Toggle markers">
            ${c.markersVisible?f.eye:f.eyeOff}
          </button>
          <button class="agentation-btn" data-action="copy" title="Copy to clipboard">
            ${f.copy}
          </button>
          <button class="agentation-btn" data-action="clear" title="Clear annotations">
            ${f.trash}
          </button>
          <span class="agentation-count">${t}</span>
          <div class="agentation-divider"></div>
          <button class="agentation-btn" data-action="close" title="Close">
            ${f.close}
          </button>
        </div>
      `}
    </div>
  `}function Ct(){let t=document.createElement("div");t.className="agentation-markers-fixed",document.body.appendChild(t);let e=document.createElement("div");e.className="agentation-markers-scroll",document.body.appendChild(e),k={fixed:t,scroll:e}}function $(){if(!k||(k.fixed.innerHTML="",k.scroll.innerHTML="",!c.markersVisible))return;P().forEach((e,n)=>{let o=document.createElement("div");o.className=`agentation-marker ${e.isMultiSelect?"multi-select":""}`,o.style.setProperty("--agentation-accent",c.accentColor),o.textContent=n+1,o.dataset.id=e.id,o.title=e.comment||e.element,e.isFixed?(o.style.left=`${e.x}%`,o.style.top=`${e.y}px`,k.fixed.appendChild(o)):(o.style.left=`${e.x}%`,o.style.top=`${e.y}px`,k.scroll.appendChild(o))})}function $t(){d.addEventListener("click",St),document.addEventListener("click",Et,!0),document.addEventListener("mouseover",Tt),document.addEventListener("mouseout",Lt)}function St(t){let e=t.target.closest("[data-action]");if(E){E=!1,d.classList.remove("collapsed"),b();return}if(!e)return;switch(e.dataset.action){case"toggle":rt();break;case"visibility":c.markersVisible=!c.markersVisible,X(c),b(),$();break;case"copy":At(e);break;case"clear":M(),b(),$();break;case"close":E=!0,d.classList.add("collapsed"),st(!1),b();break}}async function At(t){let e=P();if(e.length===0)return;let n=tt(e,{detail:c.detail,format:c.format,route:j.route});await et(n)&&(t.innerHTML=f.check,t.classList.add("active"),setTimeout(()=>{t.innerHTML=f.copy,t.classList.remove("active")},1500),c.autoClearOnCopy&&(M(),b(),$()))}function Et(t){if(!S||d.contains(t.target)||t.target.closest(".agentation-popup")||t.target.closest(".agentation-marker")||(c.blockInteractions&&(t.preventDefault(),t.stopPropagation()),N()))return;let e=t.target,n=y(e),o=window.getSelection()?.toString()?.trim()||"";u&&(u.removeAttribute("data-agentation-highlight"),u=null),nt(e,n,i=>{Q(e,i,o),b(),$()},()=>{},{theme:c.theme,accentColor:c.accentColor})}function Tt(t){S&&(d.contains(t.target)||t.target.closest(".agentation-popup")||t.target.closest(".agentation-marker")||N()||(u&&u.removeAttribute("data-agentation-highlight"),u=t.target,u.setAttribute("data-agentation-highlight","")))}function Lt(t){S&&u&&!u.contains(t.relatedTarget)&&(u.removeAttribute("data-agentation-highlight"),u=null)}function rt(){st(!S)}function st(t){S=t,t?c.blockInteractions&&document.body.classList.add("agentation-blocking"):(document.body.classList.remove("agentation-blocking"),u&&(u.removeAttribute("data-agentation-highlight"),u=null),v());let e=d.querySelector('[data-action="toggle"]');e&&e.classList.toggle("active",t)}(function(){"use strict";let t=window.__AGENTATION_CONFIG__||{};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>O(t)):O(t),window.__AGENTATION_LOADED__=!0})();})();
